const { Pool } = require('pg');

const pool = new Pool(
    {
        user: 'postgres',
        password: 'Hunter123!',
        host: 'localhost',
        database: 'employee_db'
    },
    console.log(`Connected to Employee Database System!`)
)

pool.connect();

const viewDepartments = (start) =>
    pool.query('SELECT * FROM department ;', (err, { rows }) => {
        console.table(rows)
        start()
    })


const viewRoles = (start) =>
    pool.query('SELECT role.id, role.title, role.salary, department.name FROM role JOIN department ON role.department_id = department.id', (err, { rows }) => {
        console.table(rows)
        start()
    })

const viewEmployees = (start) => {
    pool.query(`SELECT employee.id, employee.first_name, employee.last_name, role.title, role.salary, CONCAT(manager.first_name, ' ', manager.last_name) AS manager_name FROM employee JOIN role ON employee.role_id = role.id LEFT JOIN employee AS manager ON employee.manager_id = manager.id`, (err, { rows }) => {
        console.table(rows);
        start()
    })
}

module.exports = { viewDepartments, viewRoles, viewEmployees }

